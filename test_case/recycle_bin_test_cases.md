# 回收站与级联删除功能测试用例

## 一、级联逻辑删除测试

### TC-DELETE-001: 删除项目预览
**前置条件**: 已登录，存在测试项目（含5个集合、20个用例、3个环境）

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 调用预览删除接口 | 返回级联删除统计信息 |
| 2 | 检查cascade_count.collections | 值为5 |
| 3 | 检查cascade_count.test_cases | 值为20 |
| 4 | 检查cascade_count.environments | 值为3 |

### TC-DELETE-002: 项目级联删除
**前置条件**: 已登录，存在测试项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 执行级联删除项目 | 返回成功 |
| 2 | 查询项目is_deleted | 为True |
| 3 | 查询关联集合is_deleted | 全部为True |
| 4 | 查询关联用例is_deleted | 全部为True |
| 5 | 查询关联环境is_deleted | 全部为True |

### TC-DELETE-003: 集合级联删除
**前置条件**: 已登录，存在测试集合（含10个用例）

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 执行级联删除集合 | 返回成功 |
| 2 | 查询集合is_deleted | 为True |
| 3 | 查询关联用例is_deleted | 全部为True |

### TC-DELETE-004: 测试用例删除
**前置条件**: 已登录，存在测试用例（含断言和提取配置）

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 删除测试用例 | 返回成功 |
| 2 | 查询用例is_deleted | 为True |
| 3 | 查询断言配置 | 保留（物理存在） |
| 4 | 查询提取配置 | 保留（物理存在） |

## 二、回收站功能测试

### TC-RECYCLE-001: 查看回收站列表
**前置条件**: 已登录，存在已删除的项目和集合

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问回收站页面 | 显示已删除数据列表 |
| 2 | 筛选类型为项目 | 只显示已删除项目 |
| 3 | 搜索已删除项目名称 | 显示匹配结果 |

### TC-RECYCLE-002: 恢复项目
**前置条件**: 已登录，回收站有已删除项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击恢复项目 | 返回成功 |
| 2 | 查询项目is_deleted | 为False |
| 3 | 查询关联集合is_deleted | 全部恢复 |
| 4 | 查询关联用例is_deleted | 全部恢复 |

### TC-RECYCLE-003: 恢复集合
**前置条件**: 已登录，回收站有已删除集合

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击恢复集合 | 返回成功 |
| 2 | 查询集合is_deleted | 为False |
| 3 | 查询关联用例is_deleted | 全部恢复 |

### TC-RECYCLE-004: 彻底删除项目
**前置条件**: 已登录，回收站有已删除项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击彻底删除 | 二次确认弹窗 |
| 2 | 确认删除 | 返回成功 |
| 3 | 查询数据库 | 物理记录不存在 |
| 4 | 查询关联集合 | 物理记录不存在 |

### TC-RECYCLE-005: 批量恢复
**前置条件**: 已登录，回收站有多个已删除项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 选择多个项目 | 全部选中 |
| 2 | 点击批量恢复 | 全部恢复成功 |
| 3 | 查询项目is_deleted | 全部为False |

### TC-RECYCLE-006: 批量彻底删除
**前置条件**: 已登录，回收站有多个已删除项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 选择多个项目 | 全部选中 |
| 2 | 点击批量删除 | 二次确认 |
| 3 | 确认删除 | 全部物理删除成功 |

## 三、删除预览测试

### TC-PREVIEW-001: 项目删除预览
**前置条件**: 已登录，存在含子数据的项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击删除项目 | 显示预览对话框 |
| 2 | 检查显示内容 | 包含项目名称 |
| 3 | 检查级联统计 | 显示正确的子数据数量 |
| 4 | 取消删除 | 数据未被修改 |

### TC-PREVIEW-002: 空项目删除预览
**前置条件**: 已登录，存在空项目（无子数据）

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击删除项目 | 显示预览对话框 |
| 2 | 检查级联统计 | 全部为0 |
| 3 | 确认删除 | 删除成功 |

## 四、权限测试

### TC-AUTH-001: 普通用户只能看自己的数据
**前置条件**: 用户A登录，存在用户B的项目

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问回收站 | 只显示用户A的已删除数据 |
| 2 | 尝试恢复用户B的项目 | 返回403权限错误 |

### TC-AUTH-002: 超级用户可操作所有数据
**前置条件**: 超级用户登录

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问回收站 | 显示所有已删除数据 |
| 2 | 恢复其他用户项目 | 操作成功 |

### TC-AUTH-003: 内部接口权限验证
**前置条件**: 普通用户请求内部接口

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 调用物理删除接口(无认证) | 返回401未授权 |
| 2 | 调用物理删除接口(错误密钥) | 返回403禁止访问 |
| 3 | 调用物理删除接口(正确密钥) | 操作成功 |

## 五、边界测试

### TC-EDGE-001: 删除不存在的数据
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 删除不存在ID的项目 | 返回404 |

### TC-EDGE-002: 恢复已恢复数据
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 重复恢复同一数据 | 返回数据已存在提示 |

### TC-EDGE-003: 大量数据删除
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 删除含1000个用例的项目 | 操作完成，响应时间<5秒 |

## 六、并发测试

### TC-CONCURRENT-001: 并发删除同一数据
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 两个用户同时删除同一项目 | 第一个成功，第二个返回已删除 |

### TC-CONCURRENT-002: 删除中恢复
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 删除项目同时恢复 | 返回冲突提示 |
